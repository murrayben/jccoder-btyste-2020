{% extends "base_admin.html" %}

{% set question = problem_mistake.question %}
{% set closed = problem_mistake.is_closed %}

{% block modals %}
    <div class="modal fade" id="question-modal" tabindex="-1" role="dialog" aria-labelledby="viewQuestionModal" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Problem</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                </div>
                <div class="modal-body">
                    {{ question.html | safe }}
                    <h5>Options:</h5>
                    {% if question.question_type.code != 'S' %}
                    {% set answer = question.correct_answer() %}
                    <ul class="list-group">
                        {% for option in question.options %}
                        <li class="list-group-item{% if option == answer or option.text in answer %} list-group-item-success{% endif %}">{{ option.text | safe }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="mb-1">This is a Single Answer question.</p>
                    <p>The correct answer is {{ question.correct_answer() }}.</p>
                    {% endif %}

                    <h5 class="mt-3">Hints:</h5>
                    {% for hint in question.hints %}
                    <div>{{ hint.html | safe }}</div>
                    {% if not loop.last %}<hr />{% endif %}
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block page_content %}
    <div class="page-header">
        <h1>View Problem Mistake <span class="badge badge-{% if not closed %}danger{% else %}success{% endif %}">{{ "Open" if not closed else "Closed" }}</span></h1>
    </div>
    <h3>Reported by {{ problem_mistake.user.username if problem_mistake.user else "an anonymous user" }} on {{ moment(problem_mistake.datetime).format('dddd, Do MMMM hh:mm:ss a') }}.</h3>
    <h5>{{ problem_mistake.problem_mistake_type.mistake_type }}</h5>
    <p>{{ problem_mistake.description }}</p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#question-modal">View Problem</button>
    <a class="btn btn-{% if not closed %}success{% else %}danger{% endif %}" href="{{ url_for('.close_problem_mistake', id=problem_mistake.id) if not closed else url_for('.reopen_problem_mistake', id=problem_mistake.id) }}" role="button">{{ "Close" if not closed else "Reopen" }} issue</a>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {{ moment.include_moment() }}
{% endblock %}